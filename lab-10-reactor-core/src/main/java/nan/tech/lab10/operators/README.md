# Phase 1: åŸºç¡€æ“ä½œç¬¦æ¼”ç¤º

## ğŸ“Œ æ¦‚è¿°

æœ¬ç›®å½•åŒ…å« Lab-10 Phase 1 çš„åŸºç¡€æ“ä½œç¬¦æ¼”ç¤ºï¼Œæ¶µç›–30+ ä¸ªå¸¸ç”¨æ“ä½œç¬¦ï¼Œé‡ç‚¹æ˜¯ï¼š
1. æ·±åº¦ç†è§£è½¬æ¢ã€è¿‡æ»¤ã€ç»„åˆæ“ä½œç¬¦çš„æœ¬è´¨
2. æŒæ¡ä¸åŒæ“ä½œç¬¦çš„ç”¨é€”å’Œåº”ç”¨åœºæ™¯
3. ç†è§£æ“ä½œç¬¦ä¹‹é—´çš„åŒºåˆ«ï¼ˆå¦‚ flatMap vs concatMap vs switchMapï¼‰

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
operators/
â”œâ”€â”€ TransformOperatorsDemo.java   # è½¬æ¢æ“ä½œç¬¦æ¼”ç¤º (10ä¸ªdemo)
â”œâ”€â”€ FilterOperatorsDemo.java      # è¿‡æ»¤æ“ä½œç¬¦æ¼”ç¤º (10ä¸ªdemo)
â”œâ”€â”€ CombineOperatorsDemo.java     # ç»„åˆæ“ä½œç¬¦æ¼”ç¤º (10ä¸ªdemo)
â””â”€â”€ README.md                     # æœ¬æ–‡ä»¶
```

## ğŸ¯ æ“ä½œç¬¦åˆ†ç±»

### 1ï¸âƒ£ è½¬æ¢æ“ä½œç¬¦ï¼ˆTransformï¼‰

**å®šä¹‰**ï¼šæ”¹å˜æµä¸­å…ƒç´ çš„å½¢çŠ¶ã€ç±»å‹æˆ–å€¼çš„æ“ä½œç¬¦ã€‚

#### ç±»å‹å¯¹æ¯”

| æ“ä½œç¬¦ | è¾“å…¥è¾“å‡º | ç‰¹ç‚¹ | ç”¨é€” |
|--------|--------|------|------|
| `map(T -> R)` | 1â†’1 | åŒæ­¥è½¬æ¢ | å…ƒç´ å€¼è½¬æ¢ |
| `flatMap(T -> Flux<R>)` | 1â†’N | å¼‚æ­¥ï¼Œå¹¶å‘ | å¼‚æ­¥é“¾å¼è°ƒç”¨ |
| `concatMap(T -> Flux<R>)` | 1â†’N | å¼‚æ­¥ï¼Œé¡ºåº | å¼‚æ­¥é“¾å¼ï¼Œä¿è¯é¡ºåº |
| `switchMap(T -> Flux<R>)` | 1â†’N | å¼‚æ­¥ï¼Œåˆ‡æ¢ | æœ€æ–°ä¼˜å…ˆï¼Œå–æ¶ˆå‰é¢ |
| `scan(acc, (a,b)->a)` | Nâ†’N | ç´¯ç§¯ï¼Œå‘é€ä¸­é—´ | ç´¯åŠ ã€ç´¯è®¡ |
| `reduce(acc, (a,b)->a)` | Nâ†’1 | ç´¯ç§¯ï¼Œåªå‘é€æœ€å | æ±‚å’Œã€æ±‚ç§¯ç­‰ |
| `cast(Class<R>)` | 1â†’1 | ç±»å‹è½¬æ¢ | å¼ºåˆ¶ç±»å‹è½¬æ¢ |
| `then(Mono)` | 0â†’1 | å¿½ç•¥å…ƒç´  | é¡ºåºæ‰§è¡Œ |
| `thenMany(Flux)` | 0â†’N | å¿½ç•¥å…ƒç´  | é¡ºåºè¿æ¥ |

#### æ¼”ç¤ºè¯¦è§£

**demo1: map() - 1å¯¹1è½¬æ¢**
```java
Flux.range(1, 5)
    .map(x -> x * 10)
    .subscribe(...);  // è¾“å‡ºï¼š10, 20, 30, 40, 50
```

**demo2: map() é“¾å¼è°ƒç”¨**
```java
Flux.range(1, 3)
    .map(x -> x * 2)      // 2, 4, 6
    .map(x -> x + 10)     // 12, 14, 16
    .map(x -> "val:" + x) // "val:12", "val:14", "val:16"
```

**demo3: flatMap() - 1å¯¹Nå¼‚æ­¥è½¬æ¢**
```java
Flux.range(1, 3)
    .flatMap(x -> Flux.just(x*10, x*10+1, x*10+2))
    // è¾“å‡ºï¼ˆé¡ºåºä¸å®šï¼‰ï¼š10,11,12,20,21,22,30,31,32
```

**demo4: concatMap() vs flatMap()**
```
flatMapï¼šå¹¶å‘å¤„ç†
  sub1 â†’ [10,11,12]  â”
  sub2 â†’ [20,21,22]  â”œâ”€ å¹¶å‘å‘é€ï¼Œé¡ºåºä¸å®š
  sub3 â†’ [30,31,32]  â”˜

concatMapï¼šé¡ºåºå¤„ç†
  sub1 â†’ [10,11,12] å®Œæˆ â†’
  sub2 â†’ [20,21,22] å®Œæˆ â†’
  sub3 â†’ [30,31,32]
  è¾“å‡ºé¡ºåºå›ºå®šï¼š10,11,12,20,21,22,30,31,32
```

**demo5: switchMap() - æœ€æ–°ä¼˜å…ˆ**
```
æ–°å…ƒç´ åˆ°æ¥æ—¶ï¼Œå–æ¶ˆå‰é¢çš„æµ
åº”ç”¨åœºæ™¯ï¼š
  - ç”¨æˆ·æœç´¢æ¡†è¾“å…¥
  - æ¯æ¬¡è¾“å…¥éƒ½æœç´¢æ–°çš„å†…å®¹
  - å‰é¢æœªå®Œæˆçš„æœç´¢è¢«å–æ¶ˆ
```

**demo6: scan() - ç´¯ç§¯ï¼Œå‘é€ä¸­é—´ç»“æœ**
```java
Flux.range(1, 5)
    .scan(0, (acc, x) -> acc + x)
    // è¾“å‡ºï¼š1, 3, 6, 10, 15ï¼ˆæ¯æ­¥çš„ç´¯åŠ å’Œï¼‰
```

**demo7: reduce() - ç´¯ç§¯ï¼Œåªå‘é€æœ€åç»“æœ**
```java
Flux.range(1, 5)
    .reduce(0, (acc, x) -> acc + x)
    // è¾“å‡ºï¼š15ï¼ˆMonoï¼Œåªæœ‰ä¸€ä¸ªç»“æœï¼‰
```

### 2ï¸âƒ£ è¿‡æ»¤æ“ä½œç¬¦ï¼ˆFilterï¼‰

**å®šä¹‰**ï¼šæ ¹æ®æ¡ä»¶ä¿ç•™ã€é™åˆ¶æˆ–é€‰æ‹©æµä¸­çš„å…ƒç´ ã€‚

#### ç±»å‹å¯¹æ¯”

| æ“ä½œç¬¦ | åŠŸèƒ½ | è¾“å‡º | ç”¨é€” |
|--------|------|------|------|
| `filter(predicate)` | æ¡ä»¶è¿‡æ»¤ | æ»¡è¶³æ¡ä»¶çš„å…ƒç´  | ç­›é€‰æ•°æ® |
| `distinct()` | å…¨å±€å»é‡ | ä¸é‡å¤çš„å…ƒç´  | å»é‡ï¼ˆå¤§æ•°æ®æ…ç”¨ï¼‰ |
| `distinctUntilChanged()` | ç›¸é‚»å»é‡ | ä¸é‡å¤çš„ç›¸é‚»å…ƒç´  | å»é‡ï¼ˆå†…å­˜é«˜æ•ˆï¼‰ |
| `take(n)` | åªå–å‰Nä¸ª | å‰Nä¸ªå…ƒç´  | é™åˆ¶æ•°é‡ |
| `skip(n)` | è·³è¿‡å‰Nä¸ª | å‰©ä½™å…ƒç´  | åˆ†é¡µ/åç§» |
| `first()` | åªå–ç¬¬ä¸€ä¸ª | ç¬¬ä¸€ä¸ªå…ƒç´ (Mono) | å–å•ä¸ª |
| `last()` | åªå–æœ€åä¸€ä¸ª | æœ€åä¸€ä¸ªå…ƒç´ (Mono) | å–å•ä¸ª |
| `elementAt(n)` | å–ç¬¬nä¸ª | ç¬¬nä¸ªå…ƒç´ (Mono) | å–æŒ‡å®šä½ç½® |
| `timeout(Duration)` | è¶…æ—¶æ§åˆ¶ | è¶…æ—¶å‰çš„å…ƒç´  | è¶…æ—¶æ§åˆ¶ |

#### æ¼”ç¤ºè¯¦è§£

**demo1: filter() - æ¡ä»¶è¿‡æ»¤**
```java
Flux.range(1, 10)
    .filter(x -> x % 2 == 0)  // åªä¿ç•™å¶æ•°
    // è¾“å‡ºï¼š2, 4, 6, 8, 10
```

**demo2: filter() é“¾å¼è°ƒç”¨**
```java
Flux.range(1, 10)
    .filter(x -> x % 2 == 0)  // å¶æ•°ï¼š2,4,6,8,10
    .filter(x -> x > 4)       // å¤§äº4ï¼š6,8,10
```

**demo3: distinct() - å…¨å±€å»é‡**
```java
Flux.just(1, 2, 2, 3, 2, 4, 3, 5)
    .distinct()
    // è¾“å‡ºï¼š1, 2, 3, 4, 5
    // æ³¨æ„ï¼šéœ€è¦è®°ä½æ‰€æœ‰å…ƒç´ ï¼Œå†…å­˜å ç”¨é«˜
```

**demo4: distinctUntilChanged() - ç›¸é‚»å»é‡**
```java
Flux.just(1, 2, 2, 3, 2, 4, 3, 3)
    .distinctUntilChanged()
    // è¾“å‡ºï¼š1, 2, 3, 2, 4, 3
    // æ³¨æ„ï¼šåªè®°ä½å‰ä¸€ä¸ªå…ƒç´ ï¼Œå†…å­˜å ç”¨ä½
```

**demo5-7: take/skip/pagination**
```
take(n) - åªå–å‰nä¸ª
skip(n) - è·³è¿‡å‰nä¸ª
take(n).skip(m) - åˆ†é¡µï¼šç¬¬ (m/n)+1 é¡µï¼Œæ¯é¡µnä¸ª

ç¤ºä¾‹ï¼š
  Flux.range(1, 20)
    .skip(5)    // è·³è¿‡1-5
    .take(5)    // å–6-10
    // è¾“å‡ºï¼š6,7,8,9,10ï¼ˆç¬¬2é¡µï¼‰
```

### 3ï¸âƒ£ ç»„åˆæ“ä½œç¬¦ï¼ˆCombineï¼‰

**å®šä¹‰**ï¼šå°†å¤šä¸ªæµç»„åˆä¸ºä¸€ä¸ªæµã€‚

#### ç±»å‹å¯¹æ¯”

| æ“ä½œç¬¦ | è®¢é˜…æ–¹å¼ | é¡ºåº | ç”¨é€” |
|--------|---------|------|------|
| `merge(...)` | å¹¶å‘ | ä¸å®š | å¤šæºå¹¶å‘ |
| `concat(...)` | é¡ºåº | å›ºå®š | å¤šæºä¸²è” |
| `zip(...)` | å¹¶å‘ | é…å¯¹ | ç­‰é•¿é…å¯¹ |
| `combineLatest(...)` | å¹¶å‘ | æœ€æ–° | å¤šè¾“å…¥ç»„åˆ |
| `withLatestFrom(...)` | éå¯¹ç§° | é©±åŠ¨æµ | ä¸»æµ+å‰¯æµ |
| `startWith(...)` | å‰ç½® | å›ºå®š | æ·»åŠ å‰ç½®å…ƒç´  |
| `defaultIfEmpty(...)` | é™çº§ | å•ä¸ª | ç©ºæµå¤„ç† |
| `switchIfEmpty(...)` | é™çº§ | æ›¿æ¢ | æµæ›¿æ¢ |

#### æ¼”ç¤ºè¯¦è§£

**demo1: merge() - å¹¶å‘ç»„åˆ**
```
Flux 1: 1, 2, 3
Flux 2: 10, 20, 30
merge(flux1, flux2)
è¾“å‡ºï¼ˆä¸å®šåºï¼‰ï¼š1, 10, 2, 20, 3, 30

ç‰¹ç‚¹ï¼š
- å¹¶å‘è®¢é˜…ä¸¤ä¸ªFlux
- å…ƒç´ äº¤é”™å‘é€
- æœ€å¿«çš„å†³å®šé€Ÿåº¦
```

**demo2: concat() - é¡ºåºç»„åˆ**
```
Flux 1: 1, 2, 3
Flux 2: 10, 20, 30
concat(flux1, flux2)
è¾“å‡ºï¼ˆå›ºå®šåºï¼‰ï¼š1, 2, 3, 10, 20, 30

ç‰¹ç‚¹ï¼š
- ç­‰å¾…flux1å®Œæˆ
- ç„¶åå¯åŠ¨flux2
- é¡ºåºä¿è¯
```

**demo3: zip() - é…å¯¹ç»„åˆ**
```
Flux A: 1, 2, 3
Flux B: a, b, c
zip(A, B)
è¾“å‡ºï¼š(1,a), (2,b), (3,c)

ç‰¹ç‚¹ï¼š
- ç­‰å¾…ä¸¤ä¸ªFluxéƒ½æœ‰æ–°å…ƒç´ 
- å½¢æˆå…ƒç»„
- è¾ƒæ…¢çš„å†³å®šé€Ÿåº¦
```

**demo4: combineLatest() - æœ€æ–°ç»„åˆ**
```
Timeline:
Flux A: ----1----2----3|
Flux B: ------a----b----c|

combineLatest(A, B)
æ—¶åºï¼š
  - 0ms: Aäº§ç”Ÿ1ï¼Œä½†Bè¿˜æ²¡æœ‰å…ƒç´ ï¼Œç­‰å¾…
  - 60ms: Bäº§ç”Ÿaï¼Œç°åœ¨ä¸¤ä¸ªéƒ½æœ‰ï¼Œå‘é€(1,a)
  - 100ms: Aäº§ç”Ÿ2ï¼Œå‘é€(2,a)
  - 140ms: Bäº§ç”Ÿbï¼Œå‘é€(2,b)
  - 180ms: Aäº§ç”Ÿ3ï¼Œå‘é€(3,b)
  - 220ms: Bäº§ç”Ÿcï¼Œå‘é€(3,c)
  - 260ms: Aå®Œæˆï¼ŒBå®Œæˆï¼Œæµç»“æŸ

è¾“å‡ºï¼š(1,a), (2,a), (2,b), (3,b), (3,c)
```

**demo5: withLatestFrom() - éå¯¹ç§°ç»„åˆ**
```
Main: 1, 2, 3
Side: a, b, c
main.withLatestFrom(side)
è¾“å‡ºï¼š(1,a), (2,b), (3,c)

ç‰¹ç‚¹ï¼š
- Mainæµé©±åŠ¨ï¼Œæ¯ä¸ªå…ƒç´ å‘é€ä¸€æ¬¡
- ä½¿ç”¨Sideçš„æœ€æ–°å…ƒç´ 
- Sideçš„æ›´æ–°ä¸ä¼šè§¦å‘è¾“å‡º
- å¸¸ç”¨äºï¼šä¸»æµäº‹ä»¶ + å‰¯æµä¸Šä¸‹æ–‡
```

**demo6: startWith() - å‰ç½®å…ƒç´ **
```java
Flux.just(2, 3, 4)
    .startWith(1)
    // è¾“å‡ºï¼š1, 2, 3, 4
```

**demo7-8: defaultIfEmpty() / switchIfEmpty()**
```java
// ç©ºæµå¤„ç†
Flux.empty()
    .defaultIfEmpty(99)  // è¾“å‡ºï¼š99

// æµæ›¿æ¢
Flux.empty()
    .switchIfEmpty(Flux.just(10, 20))  // è¾“å‡ºï¼š10, 20
```

## ğŸ§ª è¿è¡Œæ¼”ç¤º

### è¿è¡Œ TransformOperatorsDemo
```bash
mvn compile exec:java \
  -Dexec.mainClass="nan.tech.lab10.operators.TransformOperatorsDemo" \
  -pl lab-10-reactor-core
```

### è¿è¡Œ FilterOperatorsDemo
```bash
mvn compile exec:java \
  -Dexec.mainClass="nan.tech.lab10.operators.FilterOperatorsDemo" \
  -pl lab-10-reactor-core
```

### è¿è¡Œ CombineOperatorsDemo
```bash
mvn compile exec:java \
  -Dexec.mainClass="nan.tech.lab10.operators.CombineOperatorsDemo" \
  -pl lab-10-reactor-core
```

## ğŸ“Š æ¼”ç¤ºç»Ÿè®¡

| Demoç±» | æ¼”ç¤ºæ•° | è¦†ç›–æ“ä½œç¬¦ |
|--------|--------|-----------|
| TransformOperatorsDemo | 10ä¸ª | map, flatMap, concatMap, switchMap, scan, reduce, cast, then, thenMany |
| FilterOperatorsDemo | 10ä¸ª | filter, distinct, distinctUntilChanged, take, skip, first, last, elementAt |
| CombineOperatorsDemo | 10ä¸ª | merge, concat, zip, combineLatest, withLatestFrom, startWith, defaultIfEmpty, switchIfEmpty, flatMapMany, using |
| **æ€»è®¡** | **30ä¸ª** | **30+ ç§æ“ä½œç¬¦** |

## ğŸ’¡ æ“ä½œç¬¦é€‰æ‹©æŒ‡å—

### åœºæ™¯1ï¼šæ•°æ®è½¬æ¢
**éœ€æ±‚**ï¼šå°†æ•°å­—æµ 1,2,3 è½¬ä¸º 10,20,30

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `map()`
```java
Flux.range(1, 3)
    .map(x -> x * 10)
    .subscribe(System.out::println);
```

### åœºæ™¯2ï¼šå¼‚æ­¥é“¾å¼è°ƒç”¨
**éœ€æ±‚**ï¼šæŸ¥è¯¢ç”¨æˆ·ï¼Œç„¶åæŸ¥è¯¢ç”¨æˆ·çš„è®¢å•

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `flatMap()`
```java
getUserFlux()
    .flatMap(user -> getOrdersByUser(user.id))
    .subscribe(System.out::println);
```

**å¯¹æ¯”**ï¼š
- `flatMap`ï¼šå¹¶å‘æŸ¥è¯¢ï¼Œå¿«
- `concatMap`ï¼šé¡ºåºæŸ¥è¯¢ï¼Œæ…¢ä½†æœ‰åº
- `switchMap`ï¼šæ¯ä¸ªç”¨æˆ·æ›¿æ¢å‰ä¸€ä¸ªï¼Œé€‚åˆæœç´¢æ¡†

### åœºæ™¯3ï¼šæ•°æ®è¿‡æ»¤
**éœ€æ±‚**ï¼šåªä¿ç•™å¤§äº10çš„æ•°å­—

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `filter()`
```java
Flux.range(1, 20)
    .filter(x -> x > 10)
    .subscribe(System.out::println);
```

### åœºæ™¯4ï¼šåˆ†é¡µ
**éœ€æ±‚**ï¼šç¬¬2é¡µï¼Œæ¯é¡µ10æ¡

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `skip().take()`
```java
items.skip(10)    // è·³è¿‡å‰10æ¡
     .take(10)    // å–10æ¡
     .subscribe(System.out::println);
```

### åœºæ™¯5ï¼šå¤šæºåˆå¹¶
**éœ€æ±‚**ï¼šåŒæ—¶è·å–å†…å­˜ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `merge()`
```java
Flux.merge(
    getFromCache(),
    getFromDatabase()
).subscribe(System.out::println);
```

### åœºæ™¯6ï¼šç”¨æˆ·æœç´¢è¾“å…¥
**éœ€æ±‚**ï¼šç”¨æˆ·æ¯æ¬¡è¾“å…¥éƒ½æœç´¢ï¼Œå‰é¢æœªå®Œæˆçš„æœç´¢å–æ¶ˆ

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `switchMap()`
```java
userInput.textChanges()
    .switchMap(text -> search(text))
    .subscribe(System.out::println);
```

## ğŸ“š å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Flux JavaDoc](https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html)
- [Mono JavaDoc](https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Mono.html)

### ç›¸å…³èµ„æ–™
- [Reactor æ“ä½œç¬¦æŒ‡å—](https://projectreactor.io/docs/core/release/reference/#which.operator)

## ğŸ“‹ è‡ªæ£€æ¸…å•

å­¦å®Œæœ¬æ¨¡å—ï¼Œæ£€æŸ¥ä»¥ä¸‹è¦ç‚¹ï¼š

- [ ] ç†è§£ map vs flatMap vs concatMap vs switchMap çš„åŒºåˆ«
- [ ] æŒæ¡ä½•æ—¶ä½¿ç”¨ scan å’Œ reduce
- [ ] ç†è§£ filter çš„å•/å¤šæ¡ä»¶è¿‡æ»¤
- [ ] æŒæ¡ distinct vs distinctUntilChanged çš„åŒºåˆ«
- [ ] ç†è§£åˆ†é¡µçš„å®ç°ï¼ˆskip+takeï¼‰
- [ ] ç†è§£ merge/concat/zip çš„åŒºåˆ«
- [ ] æŒæ¡ combineLatest å’Œ withLatestFrom çš„ä½¿ç”¨åœºæ™¯
- [ ] ç†è§£ switchIfEmpty å’Œ defaultIfEmpty çš„åŒºåˆ«
- [ ] çŸ¥é“ä½•æ—¶ä½¿ç”¨ startWith
- [ ] ç†è§£ using() çš„èµ„æºç®¡ç†æœºåˆ¶

## ğŸ“ å®Œæˆæ ‡å‡†

**çŸ¥è¯†ç‚¹æŒæ¡**ï¼š
- âœ… è½¬æ¢æ“ä½œç¬¦ï¼ˆ9ä¸ªï¼‰ç†è§£æ·±åº¦
- âœ… è¿‡æ»¤æ“ä½œç¬¦ï¼ˆ8ä¸ªï¼‰ç†è§£æ·±åº¦
- âœ… ç»„åˆæ“ä½œç¬¦ï¼ˆ10ä¸ªï¼‰ç†è§£æ·±åº¦
- âœ… æ“ä½œç¬¦é€‰æ‹©èƒ½åŠ›

**å®æˆ˜èƒ½åŠ›**ï¼š
- âœ… èƒ½ç‹¬ç«‹é€‰æ‹©åˆé€‚æ“ä½œç¬¦è§£å†³é—®é¢˜
- âœ… ç†è§£æ“ä½œç¬¦çš„æ€§èƒ½ç‰¹å¾
- âœ… èƒ½ä¼˜åŒ–æ“ä½œç¬¦ç»„åˆ

---

**Status**: âœ… Phase 1B - åŸºç¡€æ“ä½œç¬¦æ¼”ç¤ºï¼ˆ30ä¸ªdemoï¼‰
**Next**: Phase 1C - StepVerifier æµ‹è¯•æ¡†æ¶
**Quality Target**: â‰¥90/100

---

*æœ¬æ–‡æ¡£ç”Ÿæˆäº 2025-10-24*
*åŒ…å«30+ ä¸ªå¯è¿è¡Œçš„æ¼”ç¤ºç¨‹åº*
