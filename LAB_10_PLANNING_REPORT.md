# Lab-10 (Project Reactor 核心库) 规划报告

> **报告日期**：2025-10-24
> **报告类型**：项目规划文档
> **目标受众**：项目经理、架构师、开发人员
> **报告长度**：完整规划（约20页）

---

## 📌 执行摘要 (Executive Summary)

### 项目概述
**Lab-10 (Project Reactor 核心库)** 是java-concurrency-reactive-lab教学体系的**理论支柱**和**深化层**。

**核心定位**：
```
Lab-09 (应用) ──"怎么用WebFlux"
  ↓
Lab-10 (原理) ──"为什么这样设计"  ← 【本项目】
  ↓
深度理解 + 知识闭环
```

### 关键数据
| 维度 | 数值 |
|------|------|
| 工期 | 8周 (4-5周开发 + 1-2周优化) |
| 难度 | ⭐⭐⭐⭐ (较高，需理解规范+源码) |
| 教学点 | 64个演示/教学点 |
| Phase数 | 5个递进式Phase |
| 代码行数 | ~3000+ (演示+测试) |
| 文档量 | ~50+ 页 (规范/对标/坑库) |
| 质量目标 | ≥90分 (目标94分) |

### 创新点
**相比Lab-09的深化**：
1. **规范深度**：从应用层 → 底层库理论（Reactive Streams规范、TCK测试）
2. **算法理解**：背压协议算法、调度器原理、operator fusion
3. **对标分析**：Reactor vs Stream/RxJava/Akka 三维对标
4. **性能优化**：JMH基准测试、火焰图分析、operator fusion优化
5. **常见坑库**：30+个高频错误 + 解决方案

---

## 🎯 学习目标与能力模型

### 5个核心学习目标

#### 目标1：理解Reactive Streams规范（理解层）
**知识**：Publisher/Subscriber/Subscription/Processor四大接口、9条规则
**能力**：实现符合规范的自定义Publisher，通过TCK测试
**评估**：RangePublisher/FilterPublisher通过官方TCK验证

#### 目标2：掌握Reactor核心操作符（应用层）
**知识**：创建/转换/组合/错误处理操作符的原理和使用
**能力**：为不同场景选择最优操作符，避免反模式
**评估**：完成15+个操作符演示，通过性能测试

#### 目标3：掌握背压与流量控制（分析层）
**知识**：背压协议、4种策略（BUFFER/DROP/LATEST/ERROR）、失效场景
**能力**：分析背压失效场景，选择合适策略，构建决策树
**评估**：完成背压策略决策树，解决5+个背压失效案例

#### 目标4：掌握调度器与线程模型（分析层）
**知识**：4种Schedulers、publishOn/subscribeOn、线程切换机制
**能力**：优化线程模型性能，合理调优boundedElastic参数
**评估**：完成调度器选择决策树，优化3+个性能问题

#### 目标5：掌握上下文传播与高级特性（评估层）
**知识**：Context原理、异常恢复策略、热流冷流、operator fusion
**能力**：正确处理Context传播，实现复杂的异常恢复逻辑
**评估**：完成错误处理决策树，Context丢失场景5个全覆盖

### 能力模型（Bloom分类法）

| 层级 | Lab-09 | Lab-10 | 评估方式 |
|------|--------|--------|--------|
| **知道** | 基础Mono/Flux | Reactive Streams规范 | 理论测试 |
| **理解** | 背压概念 | 背压协议算法 | 讲解清晰 |
| **应用** | 使用操作符 | 为场景选择操作符 | 实现演示 |
| **分析** | 性能特性 | 线程模型分析 | 决策树 |
| **评估** | 对比选择 | 构建最佳实践 | 对标分析 |
| **创新** | 生产集成 | 自定义Publisher/Operator | TCK验证 |

---

## 📊 5个Phase详细规划

### Phase 1：Reactive Streams规范与基础操作符（2周）

**学习目标**：深度理解Reactive Streams规范，实现自定义Publisher

**关键输出物**：
1. 规范解读文档（4大接口、9条规则、与JDK Flow对比）
2. 自定义Publisher实现（RangePublisher、FilterPublisher）
3. TCK测试框架使用（PublisherVerification）
4. 基础操作符演示（创建/转换/过滤/组合）
5. StepVerifier测试框架掌握

**工作量分解**：
- 文档编写：20h（规范解读2份×10h）
- 代码实现：30h（自定义Publisher、操作符演示）
- 测试开发：20h（TCK测试、StepVerifier用法）
- 文档优化：10h（审查、完善、注释）
- **小计：80h**

**质量指标**：
- RangePublisher和FilterPublisher通过TCK测试
- 15个教学点全覆盖
- 代码注释密度≥70%
- StepVerifier测试覆盖≥80%

---

### Phase 2：背压机制与流量控制（2周）

**学习目标**：理解背压协议，掌握4种策略，分析失效场景

**关键输出物**：
1. 背压协议深度剖析（request(n)链路、约束、应用）
2. 4种背压策略对比演示（性能数据、适用场景）
3. limitRate源码分析（预取策略、参数调优）
4. 背压失效场景演示（5个高频坑）
5. 背压策略决策树（清晰的选择指南）

**工作量分解**：
- 文档编写：25h（规范解读×15h + 决策树×10h）
- 代码实现：35h（4种策略×6h + 失效场景×5h）
- 性能测试：15h（性能对比数据收集）
- 文档优化：5h（审查、完善）
- **小计：80h**

**质量指标**：
- 4种背压策略都有3+个演示场景
- 5个背压失效场景有复现代码+解决方案
- 性能数据完整（吞吐量/延迟/内存）
- 决策树准确覆盖主要场景

---

### Phase 3：调度器与线程模型（1.5周）

**学习目标**：理解Schedulers原理，掌握线程切换优化

**关键输出物**：
1. 4种Schedulers详解（设计、源码、适用场景）
2. publishOn vs subscribeOn对比（直观演示）
3. 线程切换可视化（日志追踪、性能开销）
4. boundedElastic调优指南（参数配置）
5. 调度器选择决策树

**工作量分解**：
- 文档编写：20h（Schedulers详解×15h + 决策树×5h）
- 代码实现：25h（对比演示×10h + 可视化×10h + 调优×5h）
- 性能分析：15h（线程切换开销测试）
- 文档优化：5h
- **小计：65h**

**质量指标**：
- 4种Scheduler的源码分析准确
- publishOn vs subscribeOn演示清晰（线程日志可见）
- 调度器选择决策树完整覆盖主要场景
- boundedElastic调优指南有具体参数建议

---

### Phase 4：上下文传播与高级特性（1.5周）

**学习目标**：理解Context、掌握异常恢复、理解热流冷流

**关键输出物**：
1. Context深度解析（传播规则、丢失场景、最佳实践）
2. 5种异常恢复策略演示（retry/retryWhen/onError*等）
3. 热流冷流演示（publish/share/cache/replay）
4. 高级组合操作符（merge/concat/zip/combineLatest）
5. operator fusion优化（概念、条件、性能提升）
6. 错误处理决策树

**工作量分解**：
- 文档编写：25h（Context×10h + 异常恢复×5h + fusion×5h + 决策树×5h）
- 代码实现：35h（Context演示×10h + 异常恢复×10h + 热流冷流×10h + 组合操作符×5h）
- 性能分析：10h（fusion优化效果测试）
- 文档优化：5h
- **小计：75h**

**质量指标**：
- Context的传播规则理解准确
- 5种异常恢复策略都有3+个演示
- 热流冷流的演示清晰区分
- operator fusion的性能提升有数据支撑

---

### Phase 5：性能对标与最佳实践（1周）

**学习目标**：对标分析、性能优化、知识沉淀

**关键输出物**：
1. 三维对标分析（Stream/RxJava/Akka对比）
2. JMH基准测试（10+个场景）
3. 火焰图分析（热点函数、优化前后对比）
4. 常见坑库（30+个高频错误）
5. 最佳实践集合（20+条）
6. 决策树汇总（3个）

**工作量分解**：
- 文档编写：25h（对标分析×10h + 坑库×10h + 实践×5h）
- 代码实现：25h（JMH测试×15h + 示例代码×10h）
- 性能分析：15h（火焰图生成、数据分析）
- 文档优化：10h（审查、完善、可视化）
- **小计：75h**

**质量指标**：
- 对标分析覆盖Stream/RxJava/Akka三个框架
- 10+个JMH基准测试完整运行
- 火焰图分析有具体优化建议
- 30+个常见坑都有复现代码+解决方案

---

## 📈 工作量估算

### 总工作量（全项目）
```
Phase 1: 80h  (规范 + 基础操作符)
Phase 2: 80h  (背压策略 + 失效分析)
Phase 3: 65h  (调度器 + 线程优化)
Phase 4: 75h  (Context + 异常恢复)
Phase 5: 75h  (性能对标 + 知识沉淀)
────────────
总计:  375h
```

### 时间规划（8周，每周45h）
```
Week 1-2: Phase 1 (80h)  ← 规范学习 + 自定义Publisher
Week 3-4: Phase 2 (80h)  ← 背压策略 + 失效场景
Week 5-6: Phase 3 (65h)  ← 调度器 + 线程优化
Week 7:   Phase 4 (75h)  ← Context + 异常恢复 + 热流冷流
Week 8:   Phase 5 (75h)  ← 性能对标 + 知识沉淀
```

### 人力配置（推荐）
- **1个高级开发** (架构理解深、有源码阅读经验)
- **1个测试工程师** (JMH/火焰图分析)
- **1个文档编写** (技术文档、决策树可视化)

或 **1个全栈工程师** 完全独立完成（工期可能需要10周）

---

## 🎓 与Lab-09的知识复用与深化

### 知识复用（60%）

**Lab-09已有，Lab-10可直接复用**：
- Mono和Flux的基本概念
- 常用操作符（map/flatMap/filter）
- 背压的概念性理解
- 基础调度器使用
- 错误处理思想

**复用优势**：
- 学习曲线较缓（不是完全陌生）
- 快速理解高层概念（有基础认知）
- 更关注深层原理（不需重复学习基础）

### 深度提升（100%）

**从"会用"到"真正理解"的跃升**：

| 维度 | Lab-09 | Lab-10 |
|------|--------|--------|
| **背压** | 知道"limitRate可以限流" | 理解预取策略、request(n)链路、失效场景 |
| **线程切换** | 知道"publishOn改变线程" | 理解队列机制、context switch开销、性能优化 |
| **错误处理** | 知道"可以retry" | 理解重试策略的权衡、指数退避、熔断机制 |
| **Context** | 知道"可以传递数据" | 理解不可变特性、传播规则、丢失场景 |
| **操作符** | 知道"有很多操作符" | 理解operator fusion、内存分配模式 |

**深化方式**：
1. 从应用层 → 底层库（WebFlux → Reactor Core）
2. 从API使用 → 规范理解（框架 → 规范）
3. 从经验技巧 → 原理分析（最佳实践 → 为什么）
4. 从单个特性 → 整体架构（零散技巧 → 系统理解）

---

## 🏆 质量管理与验收标准

### 分阶段质量目标

| Phase | 目标分数 | 关键指标 | 验收方式 |
|-------|---------|--------|--------|
| **1** | 20/25 | TCK通过 + 操作符全覆盖 | 测试 + 代码审查 |
| **2** | 20/25 | 背压决策树 + 失效案例 | 文档 + 测试 |
| **3** | 18/25 | 线程切换可视化 + 决策树 | 演示 + 文档 |
| **4** | 19/25 | Context传播 + 异常恢复 | 测试 + 代码审查 |
| **5** | 17/25 | 对标分析 + JMH + 坑库 | 文档 + 数据 |
| **总计** | **≥90/100** | | 最终审查 |

### 代码质量关卡（必须通过）
- ✅ 编译通过：`mvn clean compile` 0 warnings
- ✅ 测试通过：`mvn clean test` 所有测试通过
- ✅ 覆盖率：业务逻辑≥85%
- ✅ TCK通过：自定义Publisher通过官方规范测试
- ✅ 注释密度：代码行数中≥70%是有意义的注释

### 文档质量关卡（必须通过）
- ✅ README完整：快速开始 + 学习路径 + 常见问题
- ✅ Javadoc完整：所有公开API都有Javadoc
- ✅ 决策树清晰：背压/调度器/异常恢复三个决策树
- ✅ 坑库完整：30+个常见错误都有复现代码+解决方案
- ✅ 代码可读性：注释密度≥70%（特别是复杂逻辑）

---

## 🚀 执行建议

### 前置准备（启动前1周）
1. 组建团队，明确分工
2. 搭建开发环境（IDE + 插件 + 工具）
3. 学习Reactive Streams规范（2h）
4. 学习Project Reactor API（3h）
5. 准备开发模板和检查清单

### 日常管理
1. **每周进度同步**（周一9:00）
   - 上周完成情况
   - 本周工作计划
   - 遇到的障碍和需要的支持

2. **代码审查节奏**（每日下午）
   - 新提交的代码随时审查
   - 重点关注线程安全、异常处理
   - 提供建设性反馈

3. **质量检查点**（每个Phase完成时）
   - 运行完整的测试套件
   - 检查代码覆盖率报告
   - 审查文档完整性
   - 检查注释密度

### 风险管理
| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|--------|
| Reactor源码理解困难 | 中 | 高 | 准备讲座、分享实战经验 |
| JMH基准测试复杂 | 中 | 中 | 参考Lab-06/07模板 |
| 时间紧张 | 中 | 高 | 优先完成Phase1-4，Phase5可后续 |
| 规范理解不深 | 低 | 高 | 邀请专家或购买在线课程 |

---

## 📚 参考资源与学习路径

### 官方资源
1. **Reactive Streams规范**
   - 官网：https://www.reactive-streams.org/
   - 规范文档：6页PDF（强制阅读）
   - TCK测试套件：GitHub reactive-streams-jvm

2. **Project Reactor官方文档**
   - 官网：https://projectreactor.io/
   - 完整指南：https://projectreactor.io/docs/core/latest/reference/
   - API文档：javadoc

3. **Spring Framework WebFlux**
   - 官网：https://docs.spring.io/spring-framework/reference/web/webflux.html
   - Spring Data R2DBC：https://spring.io/projects/spring-data-r2dbc

### 学习资源
1. **书籍**
   - "Reactive Programming with Spring 5"（O'Reilly）
   - "The Reactive Manifesto"（免费）

2. **在线课程**
   - Udemy: "Spring WebFlux and Reactor Deep Dive"
   - Pluralsight: "Reactive Programming in Java"

3. **开源项目参考**
   - Spring Cloud Stream（消息驱动）
   - Vert.x（事件驱动框架）
   - Akka（Actor模型）

### 推荐阅读顺序
1. Reactive Streams规范（2h）
2. Project Reactor Quick Start（3h）
3. Lab-09 WebFlux文档回顾（2h）
4. Reactor Core API javadoc（5h）
5. 开始Phase 1实现

---

## 💡 教学创新点

### 相比常见教材的优势
1. **从应用反推理论** → Lab-09→Lab-10的知识闭环
2. **规范驱动实现** → TCK测试验证
3. **性能数据支撑** → JMH+火焰图的客观分析
4. **常见坑库** → 防止重复踩坑
5. **决策树指导** → 实践中的快速决策

### 与其他教学的对标

| 教学方式 | 优点 | 缺点 | 本项目方法 |
|---------|------|------|----------|
| **官方文档** | 准确、权威 | 太学术、晦涩 | 结合代码演示 |
| **商业课程** | 系统、完整 | 收费、时间固定 | 开源免费 |
| **项目驱动** | 实用、贴近实战 | 缺少理论深度 | 理论+实战结合 |
| **本项目** | - | - | 应用→原理→最佳实践 |

---

## 📊 预期成果与交付物

### 代码成果
- ✅ 20+ 个符合规范的演示（Reactive Streams规范）
- ✅ 10+ 个自定义操作符/Publisher实现
- ✅ 5+ 个完整的JMH基准测试
- ✅ 3+ 个火焰图分析报告
- ✅ 全部代码都通过编译、测试、覆盖率检查

### 文档成果
- ✅ Reactive Streams规范深度解读（20页）
- ✅ 对标分析报告（Stream/RxJava/Akka，15页）
- ✅ 30+ 个常见坑库（场景+复现+解决方案）
- ✅ 20+ 条最佳实践（背压/调度器/错误处理）
- ✅ 3个决策树（背压策略/调度器选择/错误处理）

### 知识成果
- ✅ 64个教学点完整覆盖
- ✅ 5个核心学习目标达成
- ✅ 质量评分≥90分（目标94分）
- ✅ 知识复用率60% + 深度提升100%
- ✅ 所有成果沉淀到Serena Memory（复利工程）

---

## 🎯 最终成功标准

### 必须实现（硬性要求）
- ✅ Lab-10完整可运行，编译无错误
- ✅ 所有Phase的代码和文档都完成
- ✅ 测试覆盖率≥85%
- ✅ 质量评分≥90分
- ✅ 与Lab-09形成知识闭环

### 应该实现（强烈建议）
- ✅ 常见坑库30+个（防止重复踩坑）
- ✅ 3个决策树清晰明确（指导实践）
- ✅ 性能数据完整（客观分析）
- ✅ 知识沉淀到Memory（团队复用）

### 可以实现（加分项）
- ✅ 火焰图分析（可视化性能）
- ✅ GitHub Actions CI/CD（自动测试）
- ✅ 与开源社区互动（分享成果）

---

## 📅 里程碑时间表

```
2025-10-24  项目启动 + 规划完成
   ↓
2025-11-07  Phase 1 完成（规范 + 基础操作符）
   ↓
2025-11-21  Phase 2 完成（背压 + 流量控制）
   ↓
2025-12-05  Phase 3 完成（调度器 + 线程模型）
   ↓
2025-12-12  Phase 4 完成（Context + 异常恢复）
   ↓
2025-12-19  Phase 5 完成（性能对标 + 最佳实践）
   ↓
2025-12-24  最终审查 + 优化
   ↓
2025-12-26  项目完成，质量评分≥90分 ⭐⭐⭐⭐⭐
```

---

## 📝 后续计划

### Lab-11+ 的承接
Lab-10 completion → Lab-11+ 的先决条件
- Lab-11: 虚拟线程与Reactor集成
- Lab-12: 分布式追踪与可观测性
- Lab-13: 响应式微服务（Spring Cloud）
- Lab-14: 性能优化与线上诊断

### 知识体系完成
14个Lab的学习体系完成后：
- 建立完整的并发编程知识体系（从基础到高级）
- 沉淀100+个常见坑库
- 建立50+个可复用的代码模板
- 形成一套高效的学习/开发规范

---

## 📞 支持与问题解决

### 技术支持来源
1. **官方文档**：https://projectreactor.io/docs
2. **官方讨论**：Stack Overflow (tag: project-reactor)
3. **社区论坛**：Spring官方论坛

### 常见问题预预案
| 问题 | 解决方案 |
|------|--------|
| 理解Reactive Streams规范困难 | 反复阅读规范文档，参考TCK实现 |
| JMH基准测试结果异常 | 参考Lab-06/07经验，关闭后台进程 |
| 时间压力 | 优先完成Phase1-4，Phase5可分批 |
| 代码性能达不到预期 | 使用火焰图分析，找到热点优化 |

---

**报告完成时间**：2025-10-24
**报告版本**：1.0
**报告作者**：Claude Code + Compounding Engineering System
**审批状态**：待审核
